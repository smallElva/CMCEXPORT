(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[47],{

/***/ "./node_modules/babel-loader/lib/index.js?!./node_modules/vue-loader/lib/index.js?!./src/components/content/system/folder/FolderTable.vue?vue&type=script&lang=js&":
/*!***********************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib??ref--1-0!./node_modules/vue-loader/lib??vue-loader-options!./src/components/content/system/folder/FolderTable.vue?vue&type=script&lang=js& ***!
  \***********************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($, swal) {/* harmony import */ var _table_folder_hdtable_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./table/folder_hdtable.js */ "./src/components/content/system/folder/table/folder_hdtable.js");
/* harmony import */ var _table_folder_info_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./table/folder_info.js */ "./src/components/content/system/folder/table/folder_info.js");
/* harmony import */ var _table_folder_methods__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./table/folder_methods */ "./src/components/content/system/folder/table/folder_methods.js");
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === "[object Arguments]")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

//
//
//
//
//
//
//
//



/* harmony default export */ __webpack_exports__["default"] = ({
  name: "FolderTable",
  props: [],
  inject: ['reload'],
  data: function data() {
    return {
      data: [],
      hot: {},
      //hottable对象
      folderList: {},
      //所有组织的集合 name索引
      folderArray: [],
      //用于遍历不同组织类型（风电、水泥、）
      changeDataList: {},
      //修改+新增的组织
      deleteIdList: [],
      //删除的数据
      scroll: 0 //滚动距离

    };
  },
  mounted: function mounted() {
    var _this = this;

    // 在点击标题的时候放大并重新渲染表格
    this.$bus.$on('reloadtable', function () {
      _this.hot.render();
    });
    this.getListData(); //获取所有的机组设置数据
  },
  beforeRouteLeave: function beforeRouteLeave(to, from, next) {
    var changeData = this.changeDataList;

    if (!$.isEmptyObject(changeData)) {
      swal({
        title: "警告",
        text: "正在离开本页面，本页面内所有未保存数据都会丢失。",
        buttons: {
          sure: "确认",
          cancel: "取消"
        },
        dangerMode: true
      }).then(function (willDelete) {
        if (willDelete) {
          next();
        } else {
          window.history.go(1);
        }
      });
    } else {
      next();
    }
  },
  methods: {
    getListData: function getListData() {
      var _this2 = this;

      this.$getApi.queryAllFolder(this.$store.state.tids).then(function (res) {
        var _getFolderInfo = Object(_table_folder_info_js__WEBPACK_IMPORTED_MODULE_1__["getFolderInfo"])(res);

        var _getFolderInfo2 = _slicedToArray(_getFolderInfo, 3);

        _this2.folderList = _getFolderInfo2[0];
        _this2.folderArray = _getFolderInfo2[1];
        _this2.data = _getFolderInfo2[2];

        if (_this2.folderArray.length > 0) {
          _this2.$store.commit('setTreeTid', _this2.folderArray[0].t_id);
        } else {
          _this2.$store.commit('setTreeTid', '-1');
        }

        _this2.renderTable();
      })["catch"](function (err) {
        console.log('请求错误', err);
      });
    },
    renderTable: function renderTable() {
      var HotTable = document.getElementById('HotTable');
      this.hot = new _table_folder_hdtable_js__WEBPACK_IMPORTED_MODULE_0__["default"](HotTable, this);
      Object(_table_folder_methods__WEBPACK_IMPORTED_MODULE_2__["reRenderSelectOption"])(this.hot, this.data);
    },
    //获取data
    getData: function getData() {
      return this.data;
    },
    getHot: function getHot() {
      return this.hot;
    },
    addRows: function addRows() {
      //新增行
      return Object(_table_folder_methods__WEBPACK_IMPORTED_MODULE_2__["addRows"])(this.hot, this.data, -1);
    },
    save: function save() {
      var _this3 = this;

      //保存组织
      var that = this;

      if (!$.isEmptyObject(that.changeDataList)) {
        var flag = this.check(that.changeDataList);

        if (flag) {
          this.changeDataList.t_ids = this.$store.state.tids;
          this.$axios.post('saveNewFolder', that.changeDataList).then(function (res) {
            _this3.changeDataList = {}; //修改的和新增的数组集合

            if (res.msg == 0) {
              swal({
                title: "提示",
                text: "\u4FDD\u5B58\u6210\u529F",
                button: "确认"
              }).then(function (value) {
                _this3.reload(); // this.$router.go(0)

              });
            } else if (res.msg == 1) {
              console.log('参数为空！');
            } else if (res.msg == 2) {
              console.log('后台运行错误！');
            }
          })["catch"](function (err) {
            console.log('请求错误', err);
          });
        }
      } else {
        swal({
          title: "提示",
          text: "\u4FDD\u5B58\u6210\u529F",
          button: "确认"
        }).then(function (value) {
          _this3.$router.go(0);
        });
      }
    },
    check: function check(folder_list) {
      for (var key in folder_list) {
        if (folder_list[key].t_name === "") {
          swal({
            title: "提示",
            text: "\u5B58\u5728\u7EC4\u7EC7\u672A\u8BBE\u7F6E\u7EC4\u7EC7\u540D",
            button: "确认"
          });
          return false;
        } else if (folder_list[key].t_pid === "") {
          /* 创建的时候默认给了上级组织 */
          swal({
            title: "提示",
            text: "\u5B58\u5728\u7EC4\u7EC7\u672A\u8BBE\u7F6E\u4E0A\u7EA7\u7EC4\u7EC7",
            button: "确认"
          });
          return false;
        }
      }

      return true;
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js"), __webpack_require__(/*! sweetalert */ "./node_modules/sweetalert/dist/sweetalert.min.js")))

/***/ }),

/***/ "./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/vue-loader/lib/index.js?!./src/components/content/system/folder/FolderTable.vue?vue&type=template&id=3bf57129&scoped=true&":
/*!***************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./src/components/content/system/folder/FolderTable.vue?vue&type=template&id=3bf57129&scoped=true& ***!
  \***************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function() {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  return _c("div", { staticClass: "myTable" }, [
    _c(
      "button",
      {
        staticClass: "my-btn btn-active white-btn btn1",
        on: {
          click: function($event) {
            return _vm.addRows()
          }
        }
      },
      [_vm._v("新建组织")]
    ),
    _vm._v(" "),
    _c(
      "button",
      {
        staticClass: "my-btn btn-active btn2",
        on: {
          click: function($event) {
            return _vm.save()
          }
        }
      },
      [_vm._v("保存设置")]
    ),
    _vm._v(" "),
    _c("div", { attrs: { id: "HotTable" } })
  ])
}
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ "./src/components/content/system/folder/FolderTable.vue":
/*!**************************************************************!*\
  !*** ./src/components/content/system/folder/FolderTable.vue ***!
  \**************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _FolderTable_vue_vue_type_template_id_3bf57129_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./FolderTable.vue?vue&type=template&id=3bf57129&scoped=true& */ "./src/components/content/system/folder/FolderTable.vue?vue&type=template&id=3bf57129&scoped=true&");
/* harmony import */ var _FolderTable_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./FolderTable.vue?vue&type=script&lang=js& */ "./src/components/content/system/folder/FolderTable.vue?vue&type=script&lang=js&");
/* empty/unused harmony star reexport *//* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");





/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__["default"])(
  _FolderTable_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _FolderTable_vue_vue_type_template_id_3bf57129_scoped_true___WEBPACK_IMPORTED_MODULE_0__["render"],
  _FolderTable_vue_vue_type_template_id_3bf57129_scoped_true___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  "3bf57129",
  null
  
)

/* hot reload */
if (false) { var api; }
component.options.__file = "src/components/content/system/folder/FolderTable.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "./src/components/content/system/folder/FolderTable.vue?vue&type=script&lang=js&":
/*!***************************************************************************************!*\
  !*** ./src/components/content/system/folder/FolderTable.vue?vue&type=script&lang=js& ***!
  \***************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_babel_loader_lib_index_js_ref_1_0_node_modules_vue_loader_lib_index_js_vue_loader_options_FolderTable_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../node_modules/babel-loader/lib??ref--1-0!../../../../../node_modules/vue-loader/lib??vue-loader-options!./FolderTable.vue?vue&type=script&lang=js& */ "./node_modules/babel-loader/lib/index.js?!./node_modules/vue-loader/lib/index.js?!./src/components/content/system/folder/FolderTable.vue?vue&type=script&lang=js&");
/* empty/unused harmony star reexport */ /* harmony default export */ __webpack_exports__["default"] = (_node_modules_babel_loader_lib_index_js_ref_1_0_node_modules_vue_loader_lib_index_js_vue_loader_options_FolderTable_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__["default"]); 

/***/ }),

/***/ "./src/components/content/system/folder/FolderTable.vue?vue&type=template&id=3bf57129&scoped=true&":
/*!*********************************************************************************************************!*\
  !*** ./src/components/content/system/folder/FolderTable.vue?vue&type=template&id=3bf57129&scoped=true& ***!
  \*********************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_FolderTable_vue_vue_type_template_id_3bf57129_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../node_modules/vue-loader/lib??vue-loader-options!./FolderTable.vue?vue&type=template&id=3bf57129&scoped=true& */ "./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/vue-loader/lib/index.js?!./src/components/content/system/folder/FolderTable.vue?vue&type=template&id=3bf57129&scoped=true&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_FolderTable_vue_vue_type_template_id_3bf57129_scoped_true___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_FolderTable_vue_vue_type_template_id_3bf57129_scoped_true___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "./src/components/content/system/folder/table/folder_hdtable.js":
/*!**********************************************************************!*\
  !*** ./src/components/content/system/folder/table/folder_hdtable.js ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(swal) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return folderhdtable; });
/* harmony import */ var network_getApi__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! network/getApi */ "./src/network/getApi.js");
/* harmony import */ var common_hdtable_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! common/hdtable.js */ "./src/common/hdtable.js");
/* harmony import */ var _folder_info_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./folder_info.js */ "./src/components/content/system/folder/table/folder_info.js");
/* harmony import */ var _folder_methods_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./folder_methods.js */ "./src/components/content/system/folder/table/folder_methods.js");
/* harmony import */ var utils_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! utils/utils */ "./src/utils/utils.js");
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }






var colWidth = '';
function folderhdtable(el, property) {
  // console.log(new Handsontable());
  var data = property.getData(); //创建表格属性的实例

  var tableDataIns = new tableData(property); // 组装振动表格数据

  var vibTable = {
    // 表格右键菜单
    contextMenu: tableDataIns.contextMenu(),
    // 表格显示的数据
    data: data,
    //表格的列
    colHeaders: tableDataIns.colHeaders(),
    //数据渲染renderData
    columns: tableDataIns.columns(),
    // //单元格属性设置
    cells: tableDataIns.cells(),
    // //单击单元格或行/列标题后触发。如果单击行/列标题，则坐标索引为负。
    afterOnCellMouseUp: tableDataIns.afterOnCellMouseUp(),
    //过滤之后
    afterFilter: tableDataIns.afterFilter(),
    // //新建行
    afterCreateRow: tableDataIns.afterCreateRow(),
    beforeChange: tableDataIns.beforeChange(),
    afterChange: tableDataIns.afterChange(),
    // //移除行事件
    beforeRemoveRow: tableDataIns.beforeRemoveRow(),
    afterRemoveRow: tableDataIns.afterRemoveRow(),
    //列宽改变
    afterColumnResize: tableDataIns.afterColumnResize()
  };
  /**列宽设置**/
  //默认情况下自适应

  if (data.length === 0) {
    //如果表格没有数据，设置默认宽度，以免表头挤在一起
    vibTable.colWidths = '170';
  } else if (data.length && colWidth !== '') {
    //如果有数据，且拖动表格列宽的情况下，保存为拖动后的列宽
    vibTable.colWidths = colWidth;
  }

  return Object(common_hdtable_js__WEBPACK_IMPORTED_MODULE_1__["default"])(el, vibTable);
}

var tableData =
/*#__PURE__*/
function () {
  function tableData(vm) {
    _classCallCheck(this, tableData);

    this.getData = vm.getData;
    this.getHot = vm.getHot;
    this.folderList = vm.folderList;
    this.folderArray = vm.folderArray;
    this.changeDataList = vm.changeDataList;
    this.deleteIdList = vm.deleteIdList;
    this.store = vm.$store, this.reRenderSelectOption = vm.reRenderSelectOption;
    this.reload = vm.reload;
  }

  _createClass(tableData, [{
    key: "contextMenu",
    value: function contextMenu() {
      var that = this;
      return {
        items: {
          "row_above": {
            name: "上方新建",
            callback: function callback(key, options) {
              Object(_folder_methods_js__WEBPACK_IMPORTED_MODULE_3__["addRows"])(that.getHot(), that.getData(), options[0].start.row);
            }
          },
          "remove_row": {
            name: '删除这行',
            callback: function callback(key, options) {
              swal({
                title: "警告",
                text: "一旦删除，该组织数据将不保留！！！确定删除吗?",
                buttons: {
                  sure: "确认",
                  cancel: "取消"
                },
                dangerMode: true
              }).then(function (willDelete) {
                if (willDelete) {
                  options.forEach(function (option) {
                    var index = option.start.row;
                    var amount = parseInt(option.end.row - option.start.row) + 1;
                    that.getHot().alter("remove_row", index, amount);
                  });
                } else {
                  return false;
                }
              });
            }
          }
        }
      };
    }
  }, {
    key: "colHeaders",
    value: function colHeaders() {
      // 使用自定义列头
      return ['组织名称', '隶属组织', '组织类型'];
    } // 表格显示的数据

  }, {
    key: "columns",
    value: function columns() {
      var _this = this;

      return [{
        data: 't_name'
      }, {
        data: 't_pName',
        editor: 'select',
        selectOptions: function selectOptions(row) {
          return _this.getData()[row].t_pName_sources;
        }
      }, {
        data: 't_root_val',
        editor: 'select',
        readOnly: true,
        selectOptions: function selectOptions(row) {
          return _this.getData()[row].t_root_sources;
        }
      }];
    }
  }, {
    key: "cells",
    value: function cells() {
      var that = this;
      return function (row, col, prop) {
        var data = that.getData();
        if (data.length == 0) return;
        var cellProperties = this;

        if (row != -1 && data[row].operate == 1 && col == 2) {
          //新建测点的组织、机组、采集器可以编辑
          cellProperties.readOnly = false;
        }
      };
    } // 列宽被改变后

  }, {
    key: "afterColumnResize",
    value: function afterColumnResize() {
      var that = this;
      return function (condition) {
        var hot = that.getHot();
        colWidth = hot.getColWidth(condition); //修改拖动后的列宽
      };
    } // 过滤的方法(有待优化)（共用）

  }, {
    key: "afterFilter",
    value: function afterFilter() {
      var that = this;
      return function (condition) {
        var hot = that.getHot();
        hot.view.wt.wtOverlays.adjustElementsSize(true);
      };
    }
  }, {
    key: "afterOnCellMouseUp",
    value: function afterOnCellMouseUp() {
      var that = this;
      return function (e, coords, td) {
        if (coords.row >= 0) {
          var row_info = Object(utils_utils__WEBPACK_IMPORTED_MODULE_4__["getRowInfoByIndex"])(coords.row, that.getData(), that.getHot());
          that.store.commit('setTreeTid', row_info.t_id);
        }
      };
    }
  }, {
    key: "afterCreateRow",
    value: function afterCreateRow() {
      //添加行事件
      var that = this;
      return function (index, amount, source) {
        //添加行事件
        var data = that.getData();
        var folder = Object(_folder_info_js__WEBPACK_IMPORTED_MODULE_2__["createFolder"])(data.length);
        that.update_t_pName_sources(folder);
        that.changeDataList[folder.t_id] = folder;
        data[index] = folder;
      };
    } //改变数据的时候拼装数据结构（共用）

  }, {
    key: "beforeChange",
    value: function beforeChange() {
      var that = this;
      return function (changes, source) {
        var data = that.getData();
        var hot = that.getHot();
        var change_index;
        var change_prop;
        var change_oldVal;
        var change_newVal;
        var folder_nameList = [];
        data.forEach(function (folder) {
          if (folder.t_name) {
            folder_nameList.push(folder.t_name);
          }
        }); //创建更改组织、机组、采集器、通道、任务的联动实例

        for (var i = 0; i < changes.length; i++) {
          var physicalRow = hot.toPhysicalRow(changes[i][0]);
          var columnVal = hot.propToCol(changes[i][1]);
          change_index = changes[i][0];
          change_prop = changes[i][1];
          change_oldVal = changes[i][2];
          change_newVal = changes[i][3];

          if (change_oldVal == change_newVal) {
            continue;
          }

          var folder = Object(utils_utils__WEBPACK_IMPORTED_MODULE_4__["getRowInfoByIndex"])(change_index, data, that.getHot());

          if (change_prop == "t_name") {
            //组织名称
            if (folder_nameList.indexOf(change_newVal) != -1) {
              swal({
                title: "提示",
                text: "\u7B2C".concat(change_index + 1, "\u884C\u7EC4\u7EC7\u91CD\u540D"),
                button: "确认"
              });
              return false;
            } else {
              folder.t_name = change_newVal;
            }
          }

          if (change_prop == "t_pName") {
            //隶属组织
            var t_pName_sources = folder.t_pName_sources;

            if (t_pName_sources.indexOf(change_newVal) == -1) {
              swal({
                title: "提示",
                text: "\u7B2C".concat(change_index + 1, "\u884C\u4E0D\u5B58\u5728\u8BE5\u7EC4\u7EC7"),
                button: "确认"
              });
              return false;
            } else {
              folder.t_pName = change_newVal;
              folder.t_pid = that.folderList[change_newVal].t_id;
            }
          }

          if (change_prop == "t_root_val") {
            //组织类型
            var t_root_sources = folder.t_root_sources;

            if (t_root_sources.indexOf(change_newVal) == -1) {
              swal({
                title: "提示",
                text: "\u7B2C".concat(change_index + 1, "\u884C\u4E0D\u5B58\u5728\u8BE5\u7EC4\u7EC7\u7C7B\u578B"),
                button: "确认"
              });
              return false;
            } else {
              folder.t_root = Object(utils_utils__WEBPACK_IMPORTED_MODULE_4__["find_key"])(change_newVal, folder.t_root_sources, folder.t_root_sources_key);
              folder.t_root_val = change_newVal;
              that.update_t_pName_sources(folder);
            }
          }

          hot.setCellMeta(physicalRow, columnVal, 'className', 'red-color');
        }
      };
    } //改变数据后的方法 （共用）

  }, {
    key: "afterChange",
    value: function afterChange() {
      var that = this;
      return function (changes, source) {
        //修改数据事件
        if (changes) {
          changes.forEach(function (change) {
            var folder = Object(utils_utils__WEBPACK_IMPORTED_MODULE_4__["getRowInfoByIndex"])(change[0], that.getData(), that.getHot());
            var sendFolder = Object(_folder_info_js__WEBPACK_IMPORTED_MODULE_2__["changFolderInfo"])(folder);
            that.changeDataList[folder.t_id] = sendFolder;
          });
        }
      };
    }
  }, {
    key: "beforeRemoveRow",
    value: function beforeRemoveRow() {
      var that = this;
      return function (index, amount) {
        //移除行事件
        if (index != null) {
          for (var i = 0; i < amount; i++) {
            var folder = Object(utils_utils__WEBPACK_IMPORTED_MODULE_4__["getRowInfoByIndex"])(index + i, that.getData(), that.getHot());

            if (folder.cids && folder.cids.length > 0) {
              swal({
                title: "提示",
                text: "\u7B2C".concat(index + i + 1, "\u884C\u8BE5\u7EC4\u7EC7\u6709\u4E0B\u7EA7\u7EC4\u7EC7\u4E0D\u53EF\u5220\uFF01"),
                button: "确认"
              });
              return false;
            } else if (folder.count == 1) {
              swal({
                title: "提示",
                text: "\u7B2C".concat(index + i + 1, "\u884C\u8BE5\u7EC4\u7EC7\u6709\u6240\u5C5E\u673A\u7EC4\u4E0D\u53EF\u5220\uFF01"),
                button: "确认"
              });
              return false;
            } else if (folder.operate == 1) {
              delete that.changeDataList[folder.t_id];
              return;
            } else {
              that.deleteIdList.push(folder.t_id);
            }
          }
        }
      };
    }
  }, {
    key: "afterRemoveRow",
    value: function afterRemoveRow() {
      var that = this;
      return function () {
        // 删除组织
        if (that.deleteIdList.length > 0) {
          network_getApi__WEBPACK_IMPORTED_MODULE_0__["default"].deleteFolder(that.deleteIdList, JSON.parse(sessionStorage.getItem('getTidList'))).then(function (res) {
            that.deleteIdList.length = 0; //请求过后将删除列表置空

            if (res.msg == 0) {
              swal({
                title: "提示",
                text: "\u5220\u9664\u7EC4\u7EC7\u6210\u529F\uFF01",
                button: "确认"
              }).then(function (value) {
                that.reload();
              });
            } else if (res.msg == 1) {
              console.log('参数为空！');
            } else if (res.msg == 2) {
              console.log('后台运行错误！');
            }
          })["catch"](function (err) {
            console.log('请求错误', err);
          });
        }
      };
    } //根据组织类型 改变可选组织项（新建组织的时候）

  }, {
    key: "update_t_pName_sources",
    value: function update_t_pName_sources(folder) {
      var t_ids = JSON.parse(sessionStorage.getItem('getTidList'));
      var t_pName_sources = [];
      this.folderArray.forEach(function (fol) {
        if (fol.t_root == folder.t_root) {
          t_pName_sources.push(fol.t_name);
        }
      });

      if (t_ids.includes('0')) {
        t_pName_sources.unshift("顶级组织");
        folder.t_pName = "顶级组织";
        folder.t_pid = -1;
      } else {
        folder.t_pName = '';
        folder.t_pid = '';
      }

      folder.t_pName_sources = t_pName_sources;
    }
  }]);

  return tableData;
}();
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! sweetalert */ "./node_modules/sweetalert/dist/sweetalert.min.js")))

/***/ }),

/***/ "./src/components/content/system/folder/table/folder_info.js":
/*!*******************************************************************!*\
  !*** ./src/components/content/system/folder/table/folder_info.js ***!
  \*******************************************************************/
/*! exports provided: getFolderInfo, createFolder, changFolderInfo */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getFolderInfo", function() { return getFolderInfo; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createFolder", function() { return createFolder; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "changFolderInfo", function() { return changFolderInfo; });
/* harmony import */ var utils_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/utils */ "./src/utils/utils.js");
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }


var t_root_sources = {
  '0': '风电',
  '1': '水泥',
  '2': '走行部',
  '3': '油田'
}; // let t_root_sources = {'0':'风电','1':'水泥'}

function getFolderInfo(res) {
  var t_ids = JSON.parse(sessionStorage.getItem('getTidList'));
  var folderList = {};
  var folderArray = [];
  var data;

  if (res === null || res === undefined) {
    console.log('数据错误！');
  }

  folderList["顶级组织"] = {
    "t_id": "-1"
  };

  if (res != undefined && res.length > 0) {
    res.forEach(function (folder) {
      folderList[folder.t_name] = {
        "t_id": folder.t_id
      };

      if (folder.t_pName) {
        //有上级组织
        folderList[folder.t_pName] = {
          "t_id": folder.t_pid
        };
      }

      folderArray.push({
        "t_root": folder.t_root,
        "t_name": folder.t_name,
        "t_id": folder.t_id
      });
    });

    if (t_ids.includes('0')) {
      var folderTree = Object(utils_utils__WEBPACK_IMPORTED_MODULE_0__["translateTree"])(res);
      data = sort_folder(folderTree);
    } else {
      //不包含顶级组织的用户
      data = sort_folder_2(res);
    }

    return [folderList, folderArray, data];
  } else {
    return [folderList, folderArray, []];
  }
}
function createFolder(index) {
  var folder = {
    operate: 1,
    updateTime: 0,
    //更新时间
    t_id: index + "A",
    //组织uid
    t_name: "",
    //组织名称
    t_pid: "",
    //上级组织uid
    t_pName: "",
    t_pName_sources: [],
    cids: [],
    count: 0,
    t_root: "0",
    //0=根节点
    t_root_val: "风电",
    t_root_sources: Object.values(t_root_sources),
    t_root_sources_key: Object.keys(t_root_sources),
    baseInfo: {}
  };
  return folder;
}
function changFolderInfo(folder) {
  //获取修改后的数据
  var data = {
    updateTime: folder.updateTime,
    //更新时间
    t_id: folder.t_id,
    //组织uid
    t_name: folder.t_name,
    //组织名称
    t_pid: folder.t_pid,
    //上级组织uid
    t_pName: folder.t_pName,
    t_root: Number(folder.t_root),
    //0=根节点
    baseInfo: folder.baseInfo
  };
  return data;
}
/* 这个方法完成的任务：1、按组织结构排序，2、不可选组织(自身，子组织，不同类型组织) */

function sort_folder(folderTree) {
  var data = [];
  var t_pName_sources; //第一遍遍历

  var sortFolder = function sortFolder(folderArray) {
    folderArray.forEach(function (item) {
      t_pName_sources = {}; //找道可选的上级组织

      find_folderSource(item.t_id, folderTree, item.t_root);
      var t_pid = item.t_pid || '-1';
      var t_pName = item.t_pName || '顶级组织';
      t_pName_sources = Object.values(t_pName_sources);
      t_pName_sources.unshift('顶级组织');
      data.push({
        operate: 0,
        updateTime: item.updateTime,
        //更新时间
        t_id: item.t_id,
        //组织uid
        t_name: item.t_name,
        //组织名称
        t_pid: t_pid,
        //上级组织uid
        t_pName: t_pName,
        //动态
        cids: item.cids,
        //子组织集合
        t_pName_sources: t_pName_sources,
        count: item.count,
        //如果是1表示有子组织
        t_root: item.t_root,
        t_root_val: t_root_sources[item.t_root],
        t_root_sources: Object.values(t_root_sources),
        t_root_sources_key: Object.keys(t_root_sources),
        baseInfo: item.baseInfo
      });

      if (typeof item.children == 'undefined' || item.children.length == 0) {
        return;
      } else {
        //按照顺序排序
        sortFolder(item.children);
      }
    });
  };

  var find_folderSource = function find_folderSource(t_id, folderList, t_root) {
    if (folderList.length == 0) {
      return;
    }

    folderList.forEach(function (fol) {
      if (fol.t_root != t_root) {
        return;
      }

      if (fol.t_id == t_id) {
        return;
      }

      if (fol.children) {
        find_folderSource(t_id, fol.children, t_root);
      }

      t_pName_sources[fol.t_id] = fol.t_name;
    });
  };

  sortFolder(folderTree);
  return data;
}
/* 第二种排序方式，适用于其他用户 单个排序，除子组织之外的所有组织作为隶属组织的可选项*/


function sort_folder_2(res) {
  var data = [];
  res.forEach(function (item) {
    var t_pid = item.t_pid || '-1';
    var t_pName = item.t_pName || '顶级组织';
    var t_pName_sources = sort_p_sources(res, item.t_id, item.t_root);

    if (!t_pName_sources.includes(t_pName)) {
      t_pName_sources.unshift(t_pName);
    }

    data.push({
      operate: 0,
      updateTime: item.updateTime,
      //更新时间
      t_id: item.t_id,
      //组织uid
      t_name: item.t_name,
      //组织名称
      t_pid: t_pid,
      //上级组织uid
      t_pName: t_pName,
      //动态
      cids: item.cids,
      //子组织集合
      t_pName_sources: t_pName_sources,
      count: item.count,
      //如果是1表示有子组织
      t_root: item.t_root,
      t_root_val: t_root_sources[item.t_root],
      t_root_sources: Object.values(t_root_sources),
      t_root_sources_key: Object.keys(t_root_sources),
      baseInfo: item.baseInfo
    });
  });
  return data;
}

function sort_p_sources(res, t_id, t_root) {
  var pids = [t_id];
  var t_pName_sources = [];

  var dataArray = _toConsumableArray(res);

  for (var i = 0; i < pids.length; i++) {
    for (var j = dataArray.length - 1; j >= 0; j--) {
      if (pids[i] == dataArray[j].t_pid) {
        //找到子级
        pids.push(dataArray[j].t_id);
        dataArray.splice(j, 1);
      }
    }
  }

  dataArray.forEach(function (item) {
    if (item.t_root == t_root) {
      if (item.t_id == t_id) return;
      t_pName_sources.push(item.t_name);
    }
  });
  return t_pName_sources;
}

/***/ }),

/***/ "./src/components/content/system/folder/table/folder_methods.js":
/*!**********************************************************************!*\
  !*** ./src/components/content/system/folder/table/folder_methods.js ***!
  \**********************************************************************/
/*! exports provided: addRows, reRenderSelectOption */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "addRows", function() { return addRows; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "reRenderSelectOption", function() { return reRenderSelectOption; });
function addRows(hot, data, row) {
  if (row == -1) {
    //通过点击新建按钮进入的方法，默认在最后一行添加
    row = 0;
  }

  hot.alter('insert_row', row);
  reRenderSelectOption(hot, data, row, true);
}
function reRenderSelectOption(hot, data, newRow, isnew) {
  //重新渲染selectOption,让每个option     
  var cellMeta = hot.getCellMetaAtRow(0);
  var rows = data.length;
  cellMeta.forEach(function (item) {
    if (item.prop == "t_root_val") {
      //组织
      if (isnew) {
        //新建行的时候的遍历 一条数据
        hot.setCellMeta(newRow, item.col, "selectOptions", function (row) {
          return data[hot.toPhysicalRow(row)].t_root_sources;
        });
      } else {
        for (var i = 0; i <= rows; i++) {
          //第一次创建hot时候的遍历 全部数据
          hot.setCellMeta(i, item.col, "selectOptions", function (row) {
            return data[hot.toPhysicalRow(row)].t_root_sources;
          });
        }
      }

      return;
    }

    if (item.prop == "t_pName") {
      //隶属组织
      if (isnew) {
        //新建行的时候的遍历 一条数据
        hot.setCellMeta(newRow, item.col, "selectOptions", function (row) {
          return data[hot.toPhysicalRow(row)].t_pName_sources;
        });
      } else {
        for (var _i = 0; _i <= rows; _i++) {
          //第一次创建hot时候的遍历 全部数据
          hot.setCellMeta(_i, item.col, "selectOptions", function (row) {
            return data[hot.toPhysicalRow(row)].t_pName_sources;
          });
        }
      }

      return;
    }
  });
}

/***/ })

}]);
//# sourceMappingURL=47-312f2497.[ext].js.map